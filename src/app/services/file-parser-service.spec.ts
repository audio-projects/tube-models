import { fileAnalysis, fileParserService } from './file-parser-service';

const fileData1 = `Point    Curve     Ia (mA)        Is (mA)       Vg (V)          Va (V)         Vs (V)         Vf (V)
1        1          0              0             -3.5            3.29           199.71         6.29 
2        1          0              0             -3.5            10.45          199.02         6.29 
3        1          0              0             -3.5            17.61          199.02         6.29 
4        1          0              0             -3.5            26.13          199.02         6.29 
5        1          0              0             -3.5            34.32          199.02         6.29 
6        1          0              0             -3.5            42.5           199.02         6.29 
7        1          0.01           0             -3.5            50.69          199.02         6.29 
8        1          0.06           0             -3.5            58.87          199.02         6.29 
9        1          0.18           0             -3.5            67.05          199.02         6.29 
10       1          0.4            0             -3.5            75.57          199.02         6.29 
11       1          0.69           0             -3.5            83.41          199.02         6.29 
12       1          1.08           0             -3.5            91.93          199.02         6.29 
13       1          1.57           0             -3.5            100.1          199.02         6.29 
14       1          2.13           0             -3.5            108.28         199.02         6.29 
15       1          2.77           0             -3.5            116.45         199.02         6.29 
16       1          3.5            0             -3.5            124.62         199.02         6.29 
17       1          4.31           0             -3.5            133.13         199.02         6.29 
18       1          5.14           0             -3.5            141.3          199.02         6.29 
19       1          6.01           0             -3.5            149.47         199.02         6.29 
20       1          6.94           0             -3.5            157.64         199.02         6.29 
21       1          7.93           0             -3.5            165.81         199.02         6.29 
22       1          8.94           0             -3.5            173.97         199.02         6.29 
23       1          9.99           0             -3.5            182.14         199.02         6.29 
24       1          11.06          0             -3.5            190.3          199.02         6.29 
25       1          12.18          0             -3.5            198.47         199.02         6.29 
26       1          13.31          0             -3.5            206.63         199.37         6.29 
27       1          14.49          0             -3.5            215.48         199.37         6.29 
28       1          15.74          0             -3.5            223.3          199.37         6.29 
29       1          16.98          0             -3.5            231.8          199.37         6.29 
30       1          18.3           0             -3.5            239.96         199.37         6.29 
31       1          19.58          0             -3.5            248.12         199.71         6.29 
1        2          0              0             -4              3.63           199.71         6.29 
2        2          0              0             -4              10.45          199.02         6.29 
3        2          0              0             -4              17.95          199.02         6.29 
4        2          0              0             -4              26.13          199.37         6.29 
5        2          0              0             -4              34.32          199.37         6.29 
6        2          0              0             -4              42.5           199.02         6.29 
7        2          0              0             -4              50.69          199.02         6.29 
8        2          0.01           0             -4              58.87          199.02         6.29 
9        2          0.06           0             -4              67.39          199.37         6.29 
10       2          0.17           0             -4              75.58          199.02         6.29 
11       2          0.35           0             -4              83.76          199.02         6.29 
12       2          0.63           0             -4              91.94          199.37         6.29 
13       2          0.99           0             -4              100.46         199.02         6.29 
14       2          1.43           0             -4              108.29         198.68         6.29 
15       2          1.95           0             -4              116.47         199.02         6.29 
16       2          2.54           0             -4              124.64         199.02         6.29 
17       2          3.24           0             -4              133.15         199.37         6.29 
18       2          3.98           0             -4              141.32         199.02         6.29 
19       2          4.78           0             -4              149.49         199.02         6.29 
20       2          5.65           0             -4              157.66         199.37         6.29 
21       2          6.57           0             -4              166.17         199.37         6.29 
22       2          7.5            0             -4              174            199.02         6.29 
23       2          8.47           0             -4              182.16         199.02         6.29 
24       2          9.48           0             -4              190.33         199.02         6.29 
25       2          10.57          0             -4              198.5          199.02         6.29 
26       2          11.66          0             -4              206.66         199.37         6.29 
27       2          12.81          0             -4              215.16         199.37         6.29 
28       2          13.97          0             -4              223.67         199.37         6.29 
29       2          15.16          0             -4              231.49         199.37         6.29 
30       2          16.43          0             -4              240.34         199.37         6.29 
31       2          17.67          0             -4              248.16         199.37         6.29 
1        3          0              0             -4.5            3.63           199.71         6.29 
2        3          0              0             -4.5            10.11          199.02         6.29 
3        3          0              0             -4.5            17.61          199.02         6.29 
4        3          0              0             -4.5            25.79          199.02         6.29 
5        3          0              0             -4.5            34.32          199.02         6.29 
6        3          0              0             -4.5            42.5           199.02         6.29 
7        3          0              0             -4.5            50.69          199.02         6.29 
8        3          0              0             -4.5            58.87          199.02         6.29 
9        3          0.02           0             -4.5            67.4           199.02         6.29 
10       3          0.07           0             -4.5            75.58          199.02         6.29 
11       3          0.17           0             -4.5            83.76          199.02         6.29 
12       3          0.35           0             -4.5            91.6           199.02         6.29 
13       3          0.62           0             -4.5            100.12         199.02         6.29 
14       3          0.96           0             -4.5            108.3          199.02         6.29 
15       3          1.37           0             -4.5            116.48         199.02         6.29 
16       3          1.86           0             -4.5            124.65         199.02         6.29 
17       3          2.44           0             -4.5            133.17         199.02         6.29 
18       3          3.08           0             -4.5            141.34         199.02         6.29 
19       3          3.79           0             -4.5            149.51         199.02         6.29 
20       3          4.56           0             -4.5            157.68         199.02         6.29 
21       3          5.41           0             -4.5            166.19         199.02         6.29 
22       3          6.29           0             -4.5            174.02         199.02         6.29 
23       3          7.2            0             -4.5            182.19         198.68         6.29 
24       3          8.14           0             -4.5            190.35         199.02         6.29 
25       3          9.15           0             -4.5            198.52         199.02         6.29 
26       3          10.21          0             -4.5            206.69         199.37         6.29 
27       3          11.31          0             -4.5            215.19         199.37         6.29 
28       3          12.45          0             -4.5            223.36         199.71         6.29 
29       3          13.57          0             -4.5            231.52         199.71         6.29 
30       3          14.78          0             -4.5            240.02         199.37         6.29 
31       3          15.98          0             -4.5            248.19         199.37         6.29 
`;

describe('services / fileParserService', () => {

    it('should parse sample file', () => {
        // act
        const result = fileParserService('file1', fileData1);
        // assert
        expect(result).toEqual({
            name: 'file1',
            series: [
                {
                    eg: -3.5,
                    es: 199.1209677419355,
                    eh: 6.29,
                    is: 0,
                    points: [
                        { index: 1, ip: 0, is: 0, eg: -3.5, ep: 3.29, es: 199.71, eh: 6.29 },
                        { index: 2, ip: 0, is: 0, eg: -3.5, ep: 10.45, es: 199.02, eh: 6.29 },
                        { index: 3, ip: 0, is: 0, eg: -3.5, ep: 17.61, es: 199.02, eh: 6.29 },
                        { index: 4, ip: 0, eg: -3.5, ep: 26.13, es: 199.02, is: 0, eh: 6.29 },
                        { index: 5, ip: 0, eg: -3.5, ep: 34.32, es: 199.02, is: 0, eh: 6.29 },
                        { index: 6, ip: 0, eg: -3.5, ep: 42.5, es: 199.02, is: 0, eh: 6.29 },
                        { index: 7, ip: 0.01, eg: -3.5, ep: 50.69, es: 199.02, is: 0, eh: 6.29 },
                        { index: 8, ip: 0.06, eg: -3.5, ep: 58.87, es: 199.02, is: 0, eh: 6.29 },
                        { index: 9, ip: 0.18, eg: -3.5, ep: 67.05, es: 199.02, is: 0, eh: 6.29 },
                        { index: 10, ip: 0.4, eg: -3.5, ep: 75.57, es: 199.02, is: 0, eh: 6.29 },
                        { index: 11, ip: 0.69, eg: -3.5, ep: 83.41, es: 199.02, is: 0, eh: 6.29 },
                        { index: 12, ip: 1.08, eg: -3.5, ep: 91.93, es: 199.02, is: 0, eh: 6.29 },
                        { index: 13, ip: 1.57, eg: -3.5, ep: 100.1, es: 199.02, is: 0, eh: 6.29 },
                        { index: 14, ip: 2.13, eg: -3.5, ep: 108.28, es: 199.02, is: 0, eh: 6.29 },
                        { index: 15, ip: 2.77, eg: -3.5, ep: 116.45, es: 199.02, is: 0, eh: 6.29 },
                        { index: 16, ip: 3.5, eg: -3.5, ep: 124.62, es: 199.02, is: 0, eh: 6.29 },
                        { index: 17, ip: 4.31, eg: -3.5, ep: 133.13, es: 199.02, is: 0, eh: 6.29 },
                        { index: 18, ip: 5.14, eg: -3.5, ep: 141.3, es: 199.02, is: 0, eh: 6.29 },
                        { index: 19, ip: 6.01, eg: -3.5, ep: 149.47, es: 199.02, is: 0, eh: 6.29 },
                        { index: 20, ip: 6.94, eg: -3.5, ep: 157.64, es: 199.02, is: 0, eh: 6.29 },
                        { index: 21, ip: 7.93, eg: -3.5, ep: 165.81, es: 199.02, is: 0, eh: 6.29 },
                        { index: 22, ip: 8.94, eg: -3.5, ep: 173.97, es: 199.02, is: 0, eh: 6.29 },
                        { index: 23, ip: 9.99, eg: -3.5, ep: 182.14, es: 199.02, is: 0, eh: 6.29 },
                        { index: 24, ip: 11.06, eg: -3.5, ep: 190.3, es: 199.02, is: 0, eh: 6.29 },
                        { index: 25, ip: 12.18, eg: -3.5, ep: 198.47, es: 199.02, is: 0, eh: 6.29 },
                        { index: 26, ip: 13.31, eg: -3.5, ep: 206.63, es: 199.37, is: 0, eh: 6.29 },
                        { index: 27, ip: 14.49, eg: -3.5, ep: 215.48, es: 199.37, is: 0, eh: 6.29 },
                        { index: 28, ip: 15.74, eg: -3.5, ep: 223.3, es: 199.37, is: 0, eh: 6.29 },
                        { index: 29, ip: 16.98, eg: -3.5, ep: 231.8, es: 199.37, is: 0, eh: 6.29 },
                        { index: 30, ip: 18.3, eg: -3.5, ep: 239.96, es: 199.37, is: 0, eh: 6.29 },
                        { index: 31, ip: 19.58, eg: -3.5, ep: 248.12, es: 199.71, is: 0, eh: 6.29 },
                    ],
                },
                {
                    eg: -4,
                    es: 199.17806451612898,
                    eh: 6.29,
                    is: 0,
                    points: [
                        { index: 1, ip: 0, eg: -4, ep: 3.63, es: 199.71, is: 0, eh: 6.29 },
                        { index: 2, ip: 0, eg: -4, ep: 10.45, es: 199.02, is: 0, eh: 6.29 },
                        { index: 3, ip: 0, eg: -4, ep: 17.95, es: 199.02, is: 0, eh: 6.29 },
                        { index: 4, ip: 0, eg: -4, ep: 26.13, es: 199.37, is: 0, eh: 6.29 },
                        { index: 5, ip: 0, eg: -4, ep: 34.32, es: 199.37, is: 0, eh: 6.29 },
                        { index: 6, ip: 0, eg: -4, ep: 42.5, es: 199.02, is: 0, eh: 6.29 },
                        { index: 7, ip: 0, eg: -4, ep: 50.69, es: 199.02, is: 0, eh: 6.29 },
                        { index: 8, ip: 0.01, eg: -4, ep: 58.87, es: 199.02, is: 0, eh: 6.29 },
                        { index: 9, ip: 0.06, eg: -4, ep: 67.39, es: 199.37, is: 0, eh: 6.29 },
                        { index: 10, ip: 0.17, eg: -4, ep: 75.58, es: 199.02, is: 0, eh: 6.29 },
                        { index: 11, ip: 0.35, eg: -4, ep: 83.76, es: 199.02, is: 0, eh: 6.29 },
                        { index: 12, ip: 0.63, eg: -4, ep: 91.94, es: 199.37, is: 0, eh: 6.29 },
                        { index: 13, ip: 0.99, eg: -4, ep: 100.46, es: 199.02, is: 0, eh: 6.29 },
                        { index: 14, ip: 1.43, eg: -4, ep: 108.29, es: 198.68, is: 0, eh: 6.29 },
                        { index: 15, ip: 1.95, eg: -4, ep: 116.47, es: 199.02, is: 0, eh: 6.29 },
                        { index: 16, ip: 2.54, eg: -4, ep: 124.64, es: 199.02, is: 0, eh: 6.29 },
                        { index: 17, ip: 3.24, eg: -4, ep: 133.15, es: 199.37, is: 0, eh: 6.29 },
                        { index: 18, ip: 3.98, eg: -4, ep: 141.32, es: 199.02, is: 0, eh: 6.29 },
                        { index: 19, ip: 4.78, eg: -4, ep: 149.49, es: 199.02, is: 0, eh: 6.29 },
                        { index: 20, ip: 5.65, eg: -4, ep: 157.66, es: 199.37, is: 0, eh: 6.29 },
                        { index: 21, ip: 6.57, eg: -4, ep: 166.17, es: 199.37, is: 0, eh: 6.29 },
                        { index: 22, ip: 7.5, eg: -4, ep: 174, es: 199.02, is: 0, eh: 6.29 },
                        { index: 23, ip: 8.47, eg: -4, ep: 182.16, es: 199.02, is: 0, eh: 6.29 },
                        { index: 24, ip: 9.48, eg: -4, ep: 190.33, es: 199.02, is: 0, eh: 6.29 },
                        { index: 25, ip: 10.57, eg: -4, ep: 198.5, es: 199.02, is: 0, eh: 6.29 },
                        { index: 26, ip: 11.66, eg: -4, ep: 206.66, es: 199.37, is: 0, eh: 6.29 },
                        { index: 27, ip: 12.81, eg: -4, ep: 215.16, es: 199.37, is: 0, eh: 6.29 },
                        { index: 28, ip: 13.97, eg: -4, ep: 223.67, es: 199.37, is: 0, eh: 6.29 },
                        { index: 29, ip: 15.16, eg: -4, ep: 231.49, es: 199.37, is: 0, eh: 6.29 },
                        { index: 30, ip: 16.43, eg: -4, ep: 240.34, es: 199.37, is: 0, eh: 6.29 },
                        { index: 31, ip: 17.67, eg: -4, ep: 248.16, es: 199.37, is: 0, eh: 6.29 },
                    ],
                },
                {
                    eg: -4.5,
                    es: 199.1209677419355,
                    eh: 6.29,
                    is: 0,
                    points: [
                        { index: 1, ip: 0, eg: -4.5, ep: 3.63, es: 199.71, is: 0, eh: 6.29 },
                        { index: 2, ip: 0, eg: -4.5, ep: 10.11, es: 199.02, is: 0, eh: 6.29 },
                        { index: 3, ip: 0, eg: -4.5, ep: 17.61, es: 199.02, is: 0, eh: 6.29 },
                        { index: 4, ip: 0, eg: -4.5, ep: 25.79, es: 199.02, is: 0, eh: 6.29 },
                        { index: 5, ip: 0, eg: -4.5, ep: 34.32, es: 199.02, is: 0, eh: 6.29 },
                        { index: 6, ip: 0, eg: -4.5, ep: 42.5, es: 199.02, is: 0, eh: 6.29 },
                        { index: 7, ip: 0, eg: -4.5, ep: 50.69, es: 199.02, is: 0, eh: 6.29 },
                        { index: 8, ip: 0, eg: -4.5, ep: 58.87, es: 199.02, is: 0, eh: 6.29 },
                        { index: 9, ip: 0.02, eg: -4.5, ep: 67.4, es: 199.02, is: 0, eh: 6.29 },
                        { index: 10, ip: 0.07, eg: -4.5, ep: 75.58, es: 199.02, is: 0, eh: 6.29 },
                        { index: 11, ip: 0.17, eg: -4.5, ep: 83.76, es: 199.02, is: 0, eh: 6.29 },
                        { index: 12, ip: 0.35, eg: -4.5, ep: 91.6, es: 199.02, is: 0, eh: 6.29 },
                        { index: 13, ip: 0.62, eg: -4.5, ep: 100.12, es: 199.02, is: 0, eh: 6.29 },
                        { index: 14, ip: 0.96, eg: -4.5, ep: 108.3, es: 199.02, is: 0, eh: 6.29 },
                        { index: 15, ip: 1.37, eg: -4.5, ep: 116.48, es: 199.02, is: 0, eh: 6.29 },
                        { index: 16, ip: 1.86, eg: -4.5, ep: 124.65, es: 199.02, is: 0, eh: 6.29 },
                        { index: 17, ip: 2.44, eg: -4.5, ep: 133.17, es: 199.02, is: 0, eh: 6.29 },
                        { index: 18, ip: 3.08, eg: -4.5, ep: 141.34, es: 199.02, is: 0, eh: 6.29 },
                        { index: 19, ip: 3.79, eg: -4.5, ep: 149.51, es: 199.02, is: 0, eh: 6.29 },
                        { index: 20, ip: 4.56, eg: -4.5, ep: 157.68, es: 199.02, is: 0, eh: 6.29 },
                        { index: 21, ip: 5.41, eg: -4.5, ep: 166.19, es: 199.02, is: 0, eh: 6.29 },
                        { index: 22, ip: 6.29, eg: -4.5, ep: 174.02, es: 199.02, is: 0, eh: 6.29 },
                        { index: 23, ip: 7.2, eg: -4.5, ep: 182.19, es: 198.68, is: 0, eh: 6.29 },
                        { index: 24, ip: 8.14, eg: -4.5, ep: 190.35, es: 199.02, is: 0, eh: 6.29 },
                        { index: 25, ip: 9.15, eg: -4.5, ep: 198.52, es: 199.02, is: 0, eh: 6.29 },
                        { index: 26, ip: 10.21, eg: -4.5, ep: 206.69, es: 199.37, is: 0, eh: 6.29 },
                        { index: 27, ip: 11.31, eg: -4.5, ep: 215.19, es: 199.37, is: 0, eh: 6.29 },
                        { index: 28, ip: 12.45, eg: -4.5, ep: 223.36, es: 199.71, is: 0, eh: 6.29 },
                        { index: 29, ip: 13.57, eg: -4.5, ep: 231.52, es: 199.71, is: 0, eh: 6.29 },
                        { index: 30, ip: 14.78, eg: -4.5, ep: 240.02, es: 199.37, is: 0, eh: 6.29 },
                        { index: 31, ip: 15.98, eg: -4.5, ep: 248.19, es: 199.37, is: 0, eh: 6.29 },
                    ],
                },
            ],
            measurementType: 'IP_EP_EG_VH',
            measurementTypeLabel: 'Ia(Va, Vg) with Vh≈6.3V',
            eh: 6.29,
            egOffset: 0,
        });
    });

    it('should parse ECC81.utd file', () => {
        const ecc81Data = `Point    Curve     Ia (mA)        Is (mA)       Vg (V)          Va (V)         Vs (V)         Vf (V)
1        1          0.05           0             -1.5            48.78          299.08         12.59 
2        1          0.1            0             -1.5            55.94          299.08         12.59 
3        1          0.17           0             -1.5            62.42          299.08         12.59 
4        1          0.27           0             -1.5            68.89          299.42         12.59 
5        1          0.4            0             -1.5            75.37          299.08         12.59 
6        1          0.56           0             -1.5            82.53          299.08         12.59 
7        1          0.74           0             -1.5            89             299.08         12.59 
8        1          0.97           0             -1.5            95.48          299.08         12.59 
9        1          1.2            0             -1.5            101.96         299.08         12.59 
10       1          1.49           0             -1.5            108.77         299.08         12.59 
11       1          1.8            0             -1.5            115.58         299.08         12.59 
12       1          2.12           0             -1.5            122.06         299.08         12.59 
13       1          2.49           0             -1.5            128.87         299.08         12.59 
14       1          2.84           0             -1.5            135.34         299.08         12.59 
15       1          3.26           0             -1.5            142.16         299.08         12.59 
16       1          3.66           0             -1.5            148.63         299.08         12.59 
17       1          4.11           0             -1.5            155.44         299.08         12.59 
18       1          4.55           0             -1.5            161.91         299.08         12.59 
19       1          5.04           0             -1.5            168.72         299.08         12.59 
20       1          5.52           0             -1.5            175.54         299.08         12.59 
21       1          6.01           0             -1.5            182.01         299.08         12.59 
22       1          6.54           0             -1.5            188.82         299.08         12.59 
23       1          7.06           0             -1.5            195.29         299.08         12.59 
24       1          7.6            0             -1.5            202.1          299.08         12.59 
25       1          8.15           0             -1.5            208.57         299.08         12.59 
26       1          8.73           0             -1.5            215.38         299.08         12.59 
27       1          9.3            0             -1.5            221.85         299.08         12.59 
28       1          9.9            0             -1.5            228.65         299.08         12.59 
29       1          10.49          0             -1.5            234.78         299.08         12.59 
30       1          11.13          0             -1.5            241.93         299.08         12.59 
31       1          11.75          0             -1.5            248.74         298.74         12.59 
1        2          0              0             -2              49.12          299.08         12.59 
2        2          0.01           0             -2              55.94          298.74         12.59 
3        2          0.03           0             -2              62.42          298.74         12.59 
4        2          0.06           0             -2              69.24          299.08         12.59 
5        2          0.11           0             -2              75.72          299.08         12.59 
6        2          0.18           0             -2              82.54          298.74         12.59 
7        2          0.27           0             -2              89.01          299.08         12.59 
8        2          0.39           0             -2              95.83          299.08         12.59 
9        2          0.53           0             -2              101.97         298.74         12.59 
10       2          0.7            0             -2              108.78         299.08         12.59 
11       2          0.9            0             -2              115.6          298.74         12.59 
12       2          1.12           0             -2              122.08         299.08         12.59 
13       2          1.37           0             -2              128.89         298.74         12.59 
14       2          1.64           0             -2              135.37         299.08         12.59 
15       2          1.95           0             -2              142.18         299.08         12.59 
16       2          2.26           0             -2              148.65         299.08         12.59 
17       2          2.61           0             -2              155.47         299.08         12.59 
18       2          2.97           0             -2              161.94         298.74         12.59 
19       2          3.36           0             -2              168.75         299.08         12.59 
20       2          3.78           0             -2              175.57         299.08         12.59 
21       2          4.19           0             -2              182.04         299.08         12.59 
22       2          4.64           0             -2              188.85         298.74         12.59 
23       2          5.08           0             -2              195.32         299.08         12.59 
24       2          5.56           0             -2              202.13         299.08         12.59 
25       2          6.03           0             -2              208.6          299.08         12.59 
26       2          6.54           0             -2              215.42         298.74         12.59 
27       2          7.03           0             -2              221.89         299.08         12.59 
28       2          7.56           0             -2              228.7          299.08         12.59 
29       2          8.08           0             -2              235.17         298.74         12.59 
30       2          8.65           0             -2              241.98         299.08         12.59 
31       2          9.25           0             -2              248.79         298.74         12.59 
1        3          0              0             -2.5            48.78          299.08         12.59 
2        3          0              0             -2.5            55.6           298.74         12.59 
3        3          0              0             -2.5            62.42          299.08         12.59 
4        3          0.01           0             -2.5            69.24          299.08         12.59 
5        3          0.02           0             -2.5            75.72          298.74         12.59 
6        3          0.04           0             -2.5            82.54          299.08         12.59 
7        3          0.08           0             -2.5            89.02          299.08         12.59 
8        3          0.13           0             -2.5            95.5           299.08         12.59 
9        3          0.19           0             -2.5            101.97         298.74         12.59 
10       3          0.28           0             -2.5            108.79         299.08         12.59 
11       3          0.39           0             -2.5            115.61         299.08         12.59 
12       3          0.52           0             -2.5            122.43         298.74         12.59 
13       3          0.68           0             -2.5            128.9          298.74         12.59 
14       3          0.86           0             -2.5            135.38         299.08         12.59 
15       3          1.07           0             -2.5            142.54         298.74         12.59 
16       3          1.28           0             -2.5            148.67         298.74         12.59 
17       3          1.54           0             -2.5            155.83         299.08         12.59 
18       3          1.82           0             -2.5            161.96         299.08         12.59 
19       3          2.11           0             -2.5            168.78         299.08         12.59 
20       3          2.44           0             -2.5            175.59         298.74         12.59 
21       3          2.76           0             -2.5            182.06         298.74         12.59 
22       3          3.13           0             -2.5            188.88         299.08         12.59 
23       3          3.49           0             -2.5            195.35         298.74         12.59 
24       3          3.89           0             -2.5            202.16         298.74         12.59 
25       3          4.29           0             -2.5            208.64         299.08         12.59 
26       3          4.73           0             -2.5            215.45         299.08         12.59 
27       3          5.15           0             -2.5            221.92         299.08         12.59 
28       3          5.63           0             -2.5            228.73         299.08         12.59 
29       3          6.07           0             -2.5            235.2          298.74         12.59 
30       3          6.58           0             -2.5            242.01         299.08         12.59 
31       3          7.09           0             -2.5            248.82         298.74         12.59 
1        4          0              0             -3              49.12          299.08         12.59 
2        4          0              0             -3              55.6           299.08         12.59 
3        4          0              0             -3              62.42          299.08         12.59 
4        4          0              0             -3              68.9           299.08         12.59 
5        4          0              0             -3              75.72          299.08         12.59 
6        4          0              0             -3              82.54          299.08         12.59 
7        4          0.01           0             -3              89.02          298.74         12.59 
8        4          0.02           0             -3              95.5           298.74         12.59 
9        4          0.05           0             -3              102.32         298.74         12.59 
10       4          0.08           0             -3              108.8          299.08         12.59 
11       4          0.13           0             -3              115.61         299.08         12.59 
12       4          0.19           0             -3              122.09         298.74         12.59 
13       4          0.27           0             -3              129.25         299.08         12.59 
14       4          0.36           0             -3              135.39         298.74         12.59 
15       4          0.48           0             -3              142.21         298.74         12.59 
16       4          0.61           0             -3              148.68         299.08         12.59 
17       4          0.78           0             -3              155.5          299.08         12.59 
18       4          0.95           0             -3              161.98         299.08         12.59 
19       4          1.16           0             -3              168.79         299.08         12.59 
20       4          1.39           0             -3              175.61         299.08         12.59 
21       4          1.63           0             -3              182.08         299.08         12.59 
22       4          1.89           0             -3              188.9          298.74         12.59 
23       4          2.18           0             -3              195.37         299.08         12.59 
24       4          2.49           0             -3              202.19         299.08         12.59 
25       4          2.8            0             -3              208.32         298.74         12.59 
26       4          3.15           0             -3              215.48         299.08         12.59 
27       4          3.51           0             -3              221.95         298.74         12.59 
28       4          3.91           0             -3              228.76         298.74         12.59 
29       4          4.26           0             -3              235.23         298.74         12.59 
30       4          4.68           0             -3              242.05         298.74         12.59 
31       4          5.12           0             -3              248.86         298.74         12.59 
1        5          0              0             -3.5            49.12          299.08         12.59 
2        5          0              0             -3.5            55.6           298.74         12.59 
3        5          0              0             -3.5            62.42          298.74         12.59 
4        5          0              0             -3.5            69.24          298.74         12.59 
5        5          0              0             -3.5            75.72          298.74         12.59 
6        5          0              0             -3.5            82.54          298.74         12.59 
7        5          0              0             -3.5            89.02          299.08         12.59 
8        5          0              0             -3.5            95.5           298.74         12.59 
9        5          0.01           0             -3.5            101.98         298.74         12.59 
10       5          0.02           0             -3.5            108.8          299.08         12.59 
11       5          0.03           0             -3.5            115.62         298.74         12.59 
12       5          0.06           0             -3.5            122.09         299.08         12.59 
13       5          0.09           0             -3.5            128.91         299.08         12.59 
14       5          0.14           0             -3.5            135.73         298.74         12.59 
15       5          0.2            0             -3.5            142.21         298.74         12.59 
16       5          0.27           0             -3.5            148.69         298.74         12.59 
17       5          0.37           0             -3.5            155.51         298.74         12.59 
18       5          0.48           0             -3.5            161.99         298.74         12.59 
19       5          0.61           0             -3.5            168.8          298.74         12.59 
20       5          0.77           0             -3.5            175.62         299.08         12.59 
21       5          0.93           0             -3.5            182.1          299.08         12.59 
22       5          1.12           0             -3.5            188.91         299.08         12.59 
23       5          1.33           0             -3.5            195.39         298.74         12.59 
24       5          1.56           0             -3.5            202.2          298.74         12.59 
25       5          1.79           0             -3.5            208.68         298.74         12.59 
26       5          2.07           0             -3.5            215.5          298.74         12.59 
27       5          2.34           0             -3.5            221.97         298.74         12.59 
28       5          2.66           0             -3.5            228.78         298.74         12.59 
29       5          2.96           0             -3.5            235.26         298.74         12.59 
30       5          3.33           0             -3.5            242.07         298.74         12.59 
31       5          3.67           0             -3.5            248.89         299.08         12.59 
`;

        // act
        const result = fileParserService('ECC81', ecc81Data);

        // assert
        expect(result).toBeDefined();
        expect(result!.name).toBe('ECC81');
        expect(result!.measurementType).toBe('IP_EP_EG_VH');
        expect(result!.eh).toBe(12.59);
        expect(result!.series.length).toBe(5);

        // Test first series (Vg = -1.5V)
        expect(result!.series[0].eg).toBe(-1.5);
        expect(result!.series[0].eh).toBe(12.59);
        expect(result!.series[0].points.length).toBe(31);
        expect(result!.series[0].points[0]).toEqual({
            index: 1,
            ip: 0.05,
            is: 0,
            eg: -1.5,
            ep: 48.78,
            es: 299.08,
            eh: 12.59
        });
        expect(result!.series[0].points[30]).toEqual({
            index: 31,
            ip: 11.75,
            is: 0,
            eg: -1.5,
            ep: 248.74,
            es: 298.74,
            eh: 12.59
        });

        // Test second series (Vg = -2V)
        expect(result!.series[1].eg).toBe(-2);
        expect(result!.series[1].eh).toBe(12.59);
        expect(result!.series[1].points.length).toBe(31);
        expect(result!.series[1].points[0]).toEqual({
            index: 1,
            ip: 0,
            is: 0,
            eg: -2,
            ep: 49.12,
            es: 299.08,
            eh: 12.59
        });

        // Test third series (Vg = -2.5V)
        expect(result!.series[2].eg).toBe(-2.5);
        expect(result!.series[2].eh).toBe(12.59);
        expect(result!.series[2].points.length).toBe(31);

        // Test fourth series (Vg = -3V)
        expect(result!.series[3].eg).toBe(-3);
        expect(result!.series[3].eh).toBe(12.59);
        expect(result!.series[3].points.length).toBe(31);

        // Test fifth series (Vg = -3.5V)
        expect(result!.series[4].eg).toBe(-3.5);
        expect(result!.series[4].eh).toBe(12.59);
        expect(result!.series[4].points.length).toBe(31);
        expect(result!.series[4].points[30]).toEqual({
            index: 31,
            ip: 3.67,
            is: 0,
            eg: -3.5,
            ep: 248.89,
            es: 299.08,
            eh: 12.59
        });
    });
});


const analyzeFile = function(filename: string, expectedType: string, expectedLabel: string, done: DoneFn) {
    // fetch test data
    fetch(filename)
        .then((response) => response.text())
        .then((data) => {
            // parse file
            const file = fileParserService(filename, data);
            if (!file) {
                // fail
                fail('Failed to parse test data');
                // done
                done();
                // exit
                return;
            }
            // analyze file
            const analysis = fileAnalysis(file);
            // expect
            expect(analysis.measurementType).toBe(expectedType);
            expect(analysis.measurementTypeLabel).toBe(expectedLabel);
            // done
            done();
        })
        .catch((error) => {
            // fail
            fail('Failed to fetch test data: ' + error);
            // done
            done();
        });
};

describe('services / fileParserService / fileAnalysis', () => {

    it('it should analyze ECC81.utd file', (done) => {
        analyzeFile('/test-assets/ECC81.utd', 'IP_EP_EG_VH', 'Ia(Va, Vg) with Vh≈12.6V', done);
    });

    it('it should analyze EF80_250.utd file', (done) => {
        analyzeFile('/test-assets/EF80_250.utd', 'IPIS_EP_EG_VS_VH', 'Ia(Va, Vg), Is(Va, Vg) with Vs≈249.2V, Vh≈6.3V', done);
    });

    it('it should analyze EL500_triode.utd file', (done) => {
        analyzeFile('/test-assets/EL500_triode.utd', 'IPIS_EPES_EG_VH', 'Ia(Va=Vs, Vg) + Is(Va=Vs, Vg) with Vh≈6.3V', done);
    });
});
