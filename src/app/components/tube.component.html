<div class="tube-detail-page">
  <!-- Header Section -->
  <div class="page-header mb-4">
    <div class="d-flex justify-content-between align-items-start">
      <div>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a routerLink="/tube" class="text-decoration-none"> <i class="bi bi-collection me-1"></i>Tubes </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              {{ tube?.name || "New Tube" }}
            </li>
          </ol>
        </nav>
        <h1 class="display-6 mb-1">
          <i class="bi bi-cpu me-2 text-primary"></i>
          {{ tube?.name || "New Tube" }}
        </h1>
        @if (tube?.manufacturer) {
          <p class="text-muted mb-0">Manufactured by {{ tube?.manufacturer }}</p>
        }
      </div>
      <div class="btn-group" role="group">
        <a class="btn btn-outline-primary" routerLink="/tube" title="Back to Tubes List"> <i class="bi bi-arrow-left me-1"></i>Back to Tubes </a>
        <button type="button" class="btn btn-outline-secondary" (click)="resetForm()" [disabled]="!tube" title="Reset Changes"><i class="bi bi-arrow-clockwise me-1"></i>Reset</button>
        <button type="button" class="btn btn-success" (click)="saveTube()" [disabled]="!tube || !isFormValid() || !canSave()" title="Save Tube"><i class="bi bi-check-lg me-1"></i>Save</button>
        <button type="button" class="btn btn-outline-danger" (click)="deleteTube()" [disabled]="!canDelete()" title="Delete Tube"><i class="bi bi-trash me-1"></i>Delete</button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  @if (tube) {
  <div class="row">
    <!-- Left Column - Basic Information -->
    <div class="col-lg-8">
      <!-- Basic Information Card -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="card-title mb-0"><i class="bi bi-info-circle me-2"></i>Basic Information</h5>
        </div>
        <div class="card-body">
          <form>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="tubeName" class="form-label fw-bold"> <i class="bi bi-tag me-1"></i>Tube Name * </label>
                  <input type="text" class="form-control" id="tubeName" [(ngModel)]="tube.name" name="tubeName" required placeholder="e.g., ECC83, 12AX7" />
                  <div class="form-text">Standard tube designation or model number</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="tubeManufacturer" class="form-label fw-bold"> <i class="bi bi-building me-1"></i>Manufacturer </label>
                  <input type="text" class="form-control" id="tubeManufacturer" [(ngModel)]="tube.manufacturer" name="tubeManufacturer" placeholder="e.g., Telefunken, RCA, Mullard" />
                  <div class="form-text">Tube manufacturer or brand</div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="tubeType" class="form-label fw-bold"> <i class="bi bi-cpu me-1"></i>Tube Type * </label>
                  <select class="form-select" id="tubeType" [(ngModel)]="tube.type" name="tubeType" required>
                    <option value="Triode">Triode</option>
                    <option value="Pentode">Pentode</option>
                    <option value="Tetrode">Tetrode</option>
                  </select>
                  <div class="form-text">Select the tube's electron configuration</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="lastUpdated" class="form-label fw-bold"> <i class="bi bi-calendar me-1"></i>Last Updated </label>
                  <input type="date" class="form-control" id="lastUpdated" [(ngModel)]="tube.lastUpdatedOn" name="lastUpdated" />
                  <div class="form-text">Date when information was last modified</div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="datasheetUrl" class="form-label fw-bold"> <i class="bi bi-file-earmark-pdf me-1"></i>Datasheet URL </label>
              <div class="input-group">
                <input type="url" class="form-control" id="datasheetUrl" [(ngModel)]="tube.datasheetUrl" name="datasheetUrl" placeholder="e.g., https://example.com/datasheets/tube.pdf" />
                <button class="btn btn-outline-primary" type="button" [disabled]="!tube.datasheetUrl" (click)="openDatasheetUrl()" title="Open datasheet in new tab">
                  <i class="bi bi-box-arrow-up-right"></i>
                </button>
              </div>
              <div class="form-text">Link to manufacturer datasheet or technical documentation</div>
            </div>

            <div class="mb-3">
              <label for="tubeComments" class="form-label fw-bold"> <i class="bi bi-chat-text me-1"></i>Comments & Notes </label>
              <textarea class="form-control" id="tubeComments" rows="4" [(ngModel)]="tube.comments" name="tubeComments" placeholder="e.g., Low noise version with gold grid, suitable for audio amplification"></textarea>
              <div class="form-text">Additional information, specifications, or usage notes</div>
            </div>
          </form>
        </div>
      </div>

      <!-- Electrical Specifications Card -->
      <div class="card mb-4">
        <div class="card-header bg-info text-white" role="button" tabindex="0" (click)="toggleElectricalSpecs()" (keydown.enter)="toggleElectricalSpecs()" (keydown.space)="toggleElectricalSpecs()" [attr.aria-expanded]="isElectricalSpecsExpanded">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0"><i class="bi bi-lightning me-2"></i>Electrical Specifications</h5>
            <i class="bi bi-chevron-down" [class.rotated]="isElectricalSpecsExpanded"></i>
          </div>
        </div>
        <div class="collapse" [class.show]="isElectricalSpecsExpanded" id="electricalSpecsCollapse">
          <div class="card-body">
            <!-- Maximum Ratings Section -->
          <h6 class="text-muted mb-3"><i class="bi bi-exclamation-triangle me-1"></i>Maximum Ratings</h6>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxPlateVoltage" class="form-label fw-bold"> Maximum Plate Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxPlateVoltage" [(ngModel)]="tube.maximumPlateVoltage" name="maxPlateVoltage" placeholder="e.g., 300" step="1" />
                  <span class="input-group-text">V</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxPlateDissipation" class="form-label fw-bold"> Maximum Plate Dissipation </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxPlateDissipation" [(ngModel)]="tube.maximumPlateDissipation" name="maxPlateDissipation" step="0.1" placeholder="e.g., 2.5" />
                  <span class="input-group-text">W</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxPlateCurrent" class="form-label fw-bold"> Maximum Plate Current </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxPlateCurrent" [(ngModel)]="tube.maximumPlateCurrent" name="maxPlateCurrent" placeholder="e.g., 10" step="0.1" />
                  <span class="input-group-text">mA</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxCathodeCurrent" class="form-label fw-bold"> Maximum Cathode Current </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxCathodeCurrent" [(ngModel)]="tube.maximumCathodeCurrent" name="maxCathodeCurrent" placeholder="e.g., 15" step="0.1" />
                  <span class="input-group-text">mA</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxGrid1Voltage" class="form-label fw-bold"> Maximum Grid 1 Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxGrid1Voltage" [(ngModel)]="tube.maximumGrid1Voltage" name="maxGrid1Voltage" placeholder="e.g., 0" step="0.1" />
                  <span class="input-group-text">V</span>
                </div>
              </div>
            </div>
            @if (tube.type === 'Pentode' || tube.type === 'Tetrode') {
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxGrid2Voltage" class="form-label fw-bold"> Maximum Grid 2 (Screen) Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxGrid2Voltage" [(ngModel)]="tube.maximumGrid2Voltage" name="maxGrid2Voltage" placeholder="e.g., 250" step="1" />
                  <span class="input-group-text">V</span>
                </div>
              </div>
            </div>
            }
          </div>

          @if (tube.type === 'Pentode' || tube.type === 'Tetrode') {
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxGrid2Dissipation" class="form-label fw-bold"> Maximum Grid 2 (Screen) Dissipation </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxGrid2Dissipation" [(ngModel)]="tube.maximumGrid2Dissipation" name="maxGrid2Dissipation" placeholder="e.g., 0.5" step="0.1" />
                  <span class="input-group-text">W</span>
                </div>
              </div>
            </div>
          </div>
          }

          <!-- Heater Specifications Section -->
          <h6 class="text-muted mb-3 mt-4"><i class="bi bi-fire me-1"></i>Heater Specifications</h6>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="minHeaterVoltage" class="form-label fw-bold"> Minimum Heater Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="minHeaterVoltage" [(ngModel)]="tube.minimumHeaterVoltage" name="minHeaterVoltage" step="0.1" placeholder="e.g., 6.0" />
                  <span class="input-group-text">V</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxHeaterVoltage" class="form-label fw-bold"> Maximum Heater Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxHeaterVoltage" [(ngModel)]="tube.maximumHeaterVoltage" name="maxHeaterVoltage" step="0.1" placeholder="e.g., 6.6" />
                  <span class="input-group-text">V</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="heaterCurrent" class="form-label fw-bold"> Heater Current </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="heaterCurrent" [(ngModel)]="tube.heaterCurrent" name="heaterCurrent" step="0.01" placeholder="e.g., 0.3" />
                  <span class="input-group-text">A</span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="heaterWarmupTime" class="form-label fw-bold"> Heater Warmup Time </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="heaterWarmupTime" [(ngModel)]="tube.heaterWarmupTime" name="heaterWarmupTime" step="1" placeholder="e.g., 30" />
                  <span class="input-group-text">sec</span>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="minHeaterToCathodeVoltage" class="form-label fw-bold"> Min Heater-Cathode Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="minHeaterToCathodeVoltage" [(ngModel)]="tube.minimumHeaterToCathodeVoltage" name="minHeaterToCathodeVoltage" step="1" placeholder="e.g., -100" />
                  <span class="input-group-text">V</span>
                </div>
                <div class="form-text">Negative value typically</div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="maxHeaterToCathodeVoltage" class="form-label fw-bold"> Max Heater-Cathode Voltage </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="maxHeaterToCathodeVoltage" [(ngModel)]="tube.maximumHeaterToCathodeVoltage" name="maxHeaterToCathodeVoltage" step="1" placeholder="e.g., 100" />
                  <span class="input-group-text">V</span>
                </div>
                <div class="form-text">Positive value typically</div>
              </div>
            </div>
          </div>

          <!-- Capacitances Section -->
          <h6 class="text-muted mb-3 mt-4"><i class="bi bi-circle me-1"></i>Capacitances</h6>
          
          <!-- Triode Capacitances -->
          @if (tube.type === 'Triode') {
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="ccg1" class="form-label fw-bold"> Cathode-Grid Capacitance (CCG) </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="ccg1" [(ngModel)]="tube.ccg1" name="ccg1" step="0.1" placeholder="e.g., 1.6" />
                  <span class="input-group-text">pF</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="cg1p" class="form-label fw-bold"> Grid-Plate Capacitance (CGP) </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="cg1p" [(ngModel)]="tube.cg1p" name="cg1p" step="0.1" placeholder="e.g., 1.7" />
                  <span class="input-group-text">pF</span>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="ccp" class="form-label fw-bold"> Cathode-Plate Capacitance (CCP) </label>
                <div class="input-group">
                  <input type="number" class="form-control" id="ccp" [(ngModel)]="tube.ccp" name="ccp" step="0.1" placeholder="e.g., 0.3" />
                  <span class="input-group-text">pF</span>
                </div>
              </div>
            </div>
          </div>
          }

          <!-- Pentode/Tetrode Capacitances -->
          @if (tube.type === 'Pentode' || tube.type === 'Tetrode') {
          <div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="ccg1Pentode" class="form-label fw-bold"> Cathode-Grid 1 Capacitance (CCG) </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="ccg1Pentode" [(ngModel)]="tube.ccg1" name="ccg1Pentode" step="0.1" placeholder="e.g., 2.5" />
                    <span class="input-group-text">pF</span>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="ccg2" class="form-label fw-bold"> Cathode-Screen Capacitance (CCS) </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="ccg2" [(ngModel)]="tube.ccg2" name="ccg2" step="0.1" placeholder="e.g., 3.0" />
                    <span class="input-group-text">pF</span>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="cg1g2" class="form-label fw-bold"> Grid 1-Screen Capacitance (CGS) </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="cg1g2" [(ngModel)]="tube.cg1g2" name="cg1g2" step="0.1" placeholder="e.g., 3.5" />
                    <span class="input-group-text">pF</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="cg1pPentode" class="form-label fw-bold"> Grid 1-Plate Capacitance (CGP) </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="cg1pPentode" [(ngModel)]="tube.cg1p" name="cg1pPentode" step="0.01" placeholder="e.g., 0.005" />
                    <span class="input-group-text">pF</span>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="ccpPentode" class="form-label fw-bold"> Cathode-Plate Capacitance (CCP) </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="ccpPentode" [(ngModel)]="tube.ccp" name="ccpPentode" step="0.1" placeholder="e.g., 0.5" />
                    <span class="input-group-text">pF</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          }
          </div>
        </div>
      </div>

      <!-- Data Files Card -->
      <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0"><i class="bi bi-file-earmark-data me-2"></i>Data Files</h5>
            <ul class="nav nav-pills nav-sm">
              <li class="nav-item">
                <button class="nav-link btn-sm" [class.active]="isTabActive('upload')" (click)="setActiveTab('upload')" type="button"><i class="bi bi-upload me-1"></i>Upload</button>
              </li>
              <li class="nav-item">
                <button class="nav-link btn-sm" [class.active]="isTabActive('plot')" [disabled]="!tube.files || tube.files.length === 0" (click)="setActiveTab('plot')" type="button"><i class="bi bi-graph-up me-1"></i>Plot</button>
              </li>
            </ul>
          </div>
        </div>
        <div class="card-body">
          <!-- Upload Tab Content -->
          @if (isTabActive('upload')) {
          <div>
            <div class="mb-3">
              <label for="dataFiles" class="form-label fw-bold"> <i class="bi bi-upload me-1"></i>Upload UTD Files </label>
              <!-- Multiple file upload with direct change handler -->
              <input 
                type="file" 
                class="form-control" 
                id="dataFiles" 
                accept=".utd" 
                multiple 
                #fileInput 
              />
              <button type="button" class="btn btn-primary mt-2" (click)="triggerFileUpload()">
                <i class="bi bi-upload me-1"></i>Select Files
              </button>
              <div class="form-text">Select one or more UTD (tube test data) files to upload. Multiple files can be selected at once.</div>
            </div>

            <!-- Upload Progress -->
            @if (uploadProgress > 0 && uploadProgress < 100) {
            <div class="mb-3">
              <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" [style.width.%]="uploadProgress" role="progressbar">{{ uploadProgress }}%</div>
              </div>
            </div>
            }

            <!-- Uploaded Files List -->
            @if (tube.files && tube.files.length > 0) {
            <div class="mb-3">
              <h6 class="fw-bold"><i class="bi bi-files me-1"></i>Uploaded Files ({{ tube.files.length }})</h6>
              <div class="list-group">
                @for (file of tube.files; track file.name; let i = $index) {
                <div class="list-group-item">
                  <div class="row align-items-center">
                    <!-- File Information Column -->
                    <div class="col-md-6">
                      <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-text me-2 text-primary"></i>
                        <div>
                          <strong>{{ file.name }}</strong>
                          <br />
                          <small class="text-muted">
                            {{ file.measurementTypeLabel }}
                            @if (file.series.length > 0) {
                            <span> • {{ file.series.length }} series • {{ getTotalPointsCount(file) }} points </span>
                            }
                          </small>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Grid Offset Column -->
                    <div class="col-md-3">
                      <label class="form-label small mb-1" for="egOffset_{{ i }}">Grid Offset (V)</label>
                      <input 
                        type="number" 
                        class="form-control form-control-sm" 
                        id="egOffset_{{ i }}"
                        [(ngModel)]="file.egOffset" 
                        name="egOffset_{{ i }}"
                        step="0.1" 
                        placeholder="e.g., 0.0"
                        title="Grid voltage offset for this file">
                    </div>
                    
                    <!-- Actions Column -->
                    <div class="col-md-3 text-end">
                      <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-success btn-sm" (click)="plotFile(file)" title="Plot file data" [disabled]="file.measurementType === 'UNKNOWN'">
                          <i class="bi bi-graph-up"></i>
                        </button>
                        <button type="button" class="btn btn-outline-info btn-sm" (click)="viewFileData(file)" title="View file data">
                          <i class="bi bi-eye"></i>
                        </button>
                        <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeFile(i)" title="Remove file">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }

            <!-- No Files Message -->
            @if (!tube.files || tube.files.length === 0) {
            <div class="text-center py-4">
              <i class="bi bi-file-earmark-plus display-6 text-muted"></i>
              <p class="text-muted mt-2 mb-0">No data files uploaded yet</p>
              <small class="text-muted">Upload UTD files to analyze tube characteristics</small>
            </div>
            }
          </div>
          }

          <!-- Plot Tab Content -->
          @if (isTabActive('plot')) {
          <div>
            <!-- File Selection for Plotting -->
            @if (tube.files && tube.files.length > 0) {
            <div class="mb-4">
              @if (selectedFileForPlot) {
              <div class="alert alert-info">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <i class="bi bi-graph-up me-2"></i>
                    <strong>Plotting:</strong> {{ selectedFileForPlot.name }}
                    <br />
                    <small>{{ selectedFileForPlot.measurementTypeLabel }}
                      @if (selectedFileForPlot.egOffset !== 0) {
                      <span> • Grid offset: {{ selectedFileForPlot.egOffset }}V</span>
                      }
                    </small>
                  </div>
                  <button type="button" class="btn btn-outline-secondary btn-sm" (click)="clearSelectedFile()"><i class="bi bi-x"></i> Clear Selection</button>
                </div>
              </div>
              }

              @if (!selectedFileForPlot) {
              <div class="mb-3">
                <h6 class="fw-bold">Select a file to plot:</h6>
                <div class="list-group">
                  @for (file of tube.files; track file.name) {
                  <button type="button" class="list-group-item list-group-item-action" [disabled]="file.measurementType === 'UNKNOWN'" (click)="selectFileForPlot(file)">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <i class="bi bi-file-earmark-text me-2 text-primary"></i>
                        <strong>{{ file.name }}</strong>
                        <br />
                        <small class="text-muted">
                          {{ file.measurementTypeLabel }}
                          @if (file.series.length > 0) {
                          <span> • {{ file.series.length }} series • {{ getTotalPointsCount(file) }} points </span>
                          }
                          @if (file.egOffset !== 0) {
                          <span> • Grid offset: {{ file.egOffset }}V </span>
                          }
                        </small>
                      </div>
                      @if (file.measurementType !== 'UNKNOWN') {
                      <div>
                        <i class="bi bi-graph-up text-success"></i>
                      </div>
                      }
                      @if (file.measurementType === 'UNKNOWN') {
                      <div>
                        <small class="text-muted">Cannot plot</small>
                      </div>
                      }
                    </div>
                  </button>
                  }
                </div>
              </div>
              }
            </div>
            }

            <!-- Plot Component -->
            @if (selectedFileForPlot) {
            <app-tube-plot [file]="selectedFileForPlot" [tube]="tube"> </app-tube-plot>
            }

            @if (!tube.files || tube.files.length === 0) {
            <div class="text-center py-4">
              <i class="bi bi-graph-up display-6 text-muted"></i>
              <p class="text-muted mt-2 mb-0">No data files to plot</p>
              <small class="text-muted">Upload UTD files first to view characteristic curves</small>
            </div>
            }
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Right Column - Summary & Actions -->
    <div class="col-lg-4">
      <!-- Tube Summary Card -->
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="card-title mb-0"><i class="bi bi-clipboard-data me-2"></i>Tube Summary</h5>
        </div>
        <div class="card-body">
          <dl class="row mb-0">
            <dt class="col-sm-5">Name:</dt>
            <dd class="col-sm-7">{{ tube.name || "Not specified" }}</dd>

            <dt class="col-sm-5">Type:</dt>
            <dd class="col-sm-7">
              <span class="badge" [ngClass]="getTypeBadgeClass(tube.type)">
                {{ tube.type }}
              </span>
            </dd>

            <dt class="col-sm-5">Manufacturer:</dt>
            <dd class="col-sm-7">{{ tube.manufacturer || "Not specified" }}</dd>

            <dt class="col-sm-5">Last Updated:</dt>
            <dd class="col-sm-7">{{ formatDate(tube.lastUpdatedOn) }}</dd>

            <dt class="col-sm-5">Status:</dt>
            <dd class="col-sm-7">
              <span class="badge bg-{{ isNewTube ? 'warning' : 'primary' }}">
                {{ isNewTube ? "New" : "Existing" }}
              </span>
            </dd>
          </dl>
        </div>
      </div>

      <!-- Triode Model Parameters Card -->
      @if (tube.type === 'Triode' || tube.type === 'Pentode' || tube.type === 'Tetrode') {
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="card-title mb-0"><i class="bi bi-cpu me-2"></i>Triode Model (Norman Koren)</h5>
        </div>
        <div class="card-body triode-model-parameters">
          <app-norman-koren-triode-model-parameters 
            [tube]="tube"
            [isCalculating]="isCalculatingTriodeParameters"
            [canCalculate]="tube.files && tube.files.length > 0"
            (calculateRequested)="calculateTriodeModelParameters()">
          </app-norman-koren-triode-model-parameters>
        </div>
      </div>
      }

      <!-- Pentode Model Parameters Card -->
      @if (tube.type !== 'Triode') {
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="card-title mb-0"><i class="bi bi-cpu me-2"></i>{{ tube.type }} Model (Norman Koren)</h5>
        </div>
        <div class="card-body pentode-model-parameters">
          <app-norman-koren-pentode-model-parameters 
            [tube]="tube"
            [isCalculating]="isCalculatingPentodeParameters"
            [canCalculate]="tube.files && tube.files.length > 0"
            (calculateRequested)="calculatePentodeModelParameters()">
          </app-norman-koren-pentode-model-parameters>
        </div>
      </div>
      }

      <!-- Derk Pentode Model Parameters Card -->
      @if (tube.type !== 'Triode') {
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="card-title mb-0"><i class="bi bi-cpu me-2"></i>{{ tube.type }} Model (Derk Model)</h5>
        </div>
        <div class="card-body derk-pentode-model-parameters">
          <app-derk-pentode-model-parameters 
            [tube]="tube"
            [isCalculating]="isCalculatingDerkParameters"
            [canCalculate]="tube.files && tube.files.length > 0"
            (calculateRequested)="calculateDerkModelParameters()">
          </app-derk-pentode-model-parameters>
        </div>
      </div>
      }

      <!-- Derk E Pentode Model Parameters Card -->
      @if (tube.type !== 'Triode') {
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="card-title mb-0"><i class="bi bi-cpu me-2"></i>{{ tube.type }} Model (Derk E Model)</h5>
        </div>
        <div class="card-body derk-pentode-model-parameters">
          <app-derke-pentode-model-parameters 
            [tube]="tube"
            [isCalculating]="isCalculatingDerkEParameters"
            [canCalculate]="tube.files && tube.files.length > 0"
            (calculateRequested)="calculateDerkEModelParameters()">
          </app-derke-pentode-model-parameters>
        </div>
      </div>
      }
    </div>
  </div>
  }
</div>
