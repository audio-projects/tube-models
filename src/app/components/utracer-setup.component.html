<div class="modal-backdrop" (click)="!isReading && close()"></div>
<div class="modal d-block">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-gear-fill me-2"></i>uTracer Setup
        </h5>
        <button type="button" class="btn-close" (click)="close()" [disabled]="isReading" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="padding-bottom: 0">
        <div class="mb-2">
          <div class="d-flex align-items-center gap-2">
            <label class="form-label mb-0 me-2">uTracer</label>
            <div class="btn-group btn-group-sm" role="radiogroup" aria-label="uTracer version">
              <input type="radio" class="btn-check" name="utracerVersion" id="utracer-v3" autocomplete="off" [(ngModel)]="uTracerVersion" [value]="'3'" (change)="onVersionChange()" [disabled]="isReading">
              <label class="btn btn-outline-primary btn-sm" for="utracer-v3">3 (300V)</label>

              <input type="radio" class="btn-check" name="utracerVersion" id="utracer-v3plus" autocomplete="off" [(ngModel)]="uTracerVersion" [value]="'3+'" (change)="onVersionChange()" [disabled]="isReading">
              <label class="btn btn-outline-primary btn-sm" for="utracer-v3plus">3+ (400V)</label>
            </div>
            <button type="button" class="btn btn-outline-secondary btn-sm" title="Selecting wrong version may damage your uTracer">
              <i class="bi bi-exclamation-triangle-fill text-danger"></i>
            </button>
          </div>
        </div>

        <div style="max-height: 45vh; overflow-y: auto;">
            <h6 class="mt-4 mb-3">Calibration</h6>
            <div class="row g-2">
              <div class="col-md-6">
                <div class="mb-1">
                  <label for="power-supply-voltage-gain" class="form-label d-block">Power Supply Voltage: {{powerSupplyVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="power-supply-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="powerSupplyVoltageGain" (input)="onPowerSupplyVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="plate-voltage-gain" class="form-label d-block">Plate Voltage: {{plateVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="plate-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="plateVoltageGain" (input)="onPlateVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="screen-voltage-gain" class="form-label d-block">Screen Voltage: {{screenVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="screen-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="screenVoltageGain" (input)="onScreenVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="plate-current-gain" class="form-label d-block">Plate Current: {{plateCurrentGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="plate-current-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="plateCurrentGain" (input)="onPlateCurrentGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="screen-current-gain" class="form-label d-block">Screen Current: {{screenCurrentGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="screen-current-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="screenCurrentGain" (input)="onScreenCurrentGainChange()" [disabled]="isReading">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-1">
                  <label for="negative-voltage-gain" class="form-label d-block">Negative Voltage: {{negativeVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="negative-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="negativeVoltageGain" (input)="onNegativeVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="grid1-volt-voltage-gain" class="form-label d-block">Grid -1V Voltage: {{grid1VoltVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="grid1-volt-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="grid1VoltVoltageGain" (input)="onGrid1VoltVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="grid4-volt-voltage-gain" class="form-label d-block">Grid -4V Voltage: {{grid4VoltVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="grid4-volt-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="grid4VoltVoltageGain" (input)="onGrid4VoltVoltageGainChange()" [disabled]="isReading">
                </div>
                <div class="mb-1">
                  <label for="grid40-volt-voltage-gain" class="form-label d-block">Grid -40V Voltage: {{grid40VoltVoltageGain.toFixed(4)}}</label>
                  <input type="range" class="form-range" id="grid40-volt-voltage-gain" min="0.9" max="1.1" step="0.0001" [(ngModel)]="grid40VoltVoltageGain" (input)="onGrid40VoltVoltageGainChange()" [disabled]="isReading">
                </div>
              </div>
            </div>
        </div>

        <app-utracer-debug [adcData]="adcData" [averaging]="averaging" [details]="true"></app-utracer-debug>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary me-auto" (click)="read()" [disabled]="isReading">Read</button>
        <button type="button" class="btn btn-secondary" (click)="close()" [disabled]="isReading">Close</button>
      </div>
    </div>
  </div>
</div>