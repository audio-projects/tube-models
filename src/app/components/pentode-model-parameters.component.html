<!-- Not calculated state -->
<div *ngIf="!tube?.pentodeModelParameters?.calculatedOn && !isCalculating" class="text-center">
  <p class="text-muted mb-3">
    <i class="bi bi-info-circle me-1"></i>
    SPICE model parameters have not been calculated yet.
  </p>
  <button type="button" class="btn btn-outline-info" (click)="calculateSpiceModelParameters()" [disabled]="!canCalculate"><i class="bi bi-calculator me-1"></i>Calculate SPICE Parameters</button>
  <div class="form-text mt-2">Requires pentode measurement data files to calculate Norman Koren model parameters</div>
</div>

<!-- Calculating state -->
<div *ngIf="isCalculating" class="text-center">
  <div class="spinner-border text-info mb-3" role="status">
    <span class="visually-hidden">Calculating...</span>
  </div>
  <p class="text-muted mb-0">
    <i class="bi bi-gear-fill me-1 text-info"></i>
    Calculating SPICE model parameters using optimization algorithms...
  </p>
  <small class="text-muted d-block mt-1">This may take a few moments</small>
</div>

<!-- Calculated state -->
<div *ngIf="tube?.pentodeModelParameters?.calculatedOn">
  <div class="row">
    <div class="col-md-6">
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Î¼ (Amplification Factor)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.mu | number : "1.3-3" }}
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Ex (Exponent)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.ex | number : "1.3-3" }}
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Kg1 (Control Grid Scaling)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.kg1 | number : "1.6-6" }}
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Kg2 (Screen Grid Scaling)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.kg2 | number : "1.6-6" }}
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Kp (Plate Current Scaling)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.kp | number : "1.6-6" }}
        </div>
      </div>
      <div class="mb-3">
        <label class="form-label fw-bold"><i class="bi bi-arrow-up-right me-1"></i>Kvb (Knee Voltage)</label>
        <div class="form-control-plaintext fw-bold text-primary">
          {{ tube?.pentodeModelParameters?.kvb | number : "1.6-6" }}
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <h6 class="fw-bold mb-3"><i class="bi bi-file-earmark-code me-1"></i>SPICE Model</h6>
    
    <div class="mb-2">
      <label class="form-label fw-bold text-muted">Subcircuit Definition</label>
      <div class="form-control-plaintext bg-light border rounded p-2">
        {{ spiceSubcktLine }}
      </div>
    </div>

    <div class="mb-2">
      <label class="form-label fw-bold text-muted">Comment</label>
      <div class="form-control-plaintext bg-light border rounded p-2">
        {{ spiceCommentLine }}
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold text-muted">Parameters</label>
      <div class="form-control-plaintext bg-light border rounded p-2" style="font-size: 0.9em; word-break: break-all;">
        {{ spiceParamLine }}
      </div>
    </div>

    <div class="text-muted small mb-3">
      <i class="bi bi-calendar3 me-1"></i>
      Calculated on {{ tube?.pentodeModelParameters?.calculatedOn | date : 'medium' }}
    </div>

    <button type="button" class="btn btn-outline-info btn-sm me-2" (click)="calculateSpiceModelParameters()">
      <i class="bi bi-arrow-clockwise me-1"></i>Recalculate
    </button>
  </div>
</div>
